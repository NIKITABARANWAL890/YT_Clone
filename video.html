<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video & Comments</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.css" integrity="sha512-kJlvECunwXftkPwyvHbclArO8wszgBGisiLeuDFwNM8ws+wKIw0sv1os3ClWZOcrEB2eRXULYUsm8OVRGJKwGA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="video.css">
</head>
<body>
    <header>
        <div class="logo">
            <i class="fa-solid fa-bars"></i>
            <img src="images/logo.png" alt="Youtube Logo" id="yt_logo">
        </div>
        <div class="nav-search-bar">
            <div class="navSearch">
                <input type="text" name="search-text" id="searchBox" placeholder="Search" autocomplete="off">
                <div id="cross-search"><i class="fa-solid fa-xmark"></i></div>
                <button id="search-button"><i class="fa-solid fa-magnifying-glass"></i></button>
                <div id="search-history">
                </div>
                </div>
        <div class="search-mic">
        <i class="fa-solid fa-microphone"></i>
        </div>
        </div>
        <div class="nav-side">
            <div class="nav-create">
                <i class="fa-solid fa-plus"></i>
                <button>Create</button>
            </div>
            <i class="fa-solid fa-bell"></i>
            <div class="user-profile">
                N
            </div>
        </div>
    </header>

    <div class="video-container">
        <!-- <a href='index.html'>HOME</a> -->
     <div id="currVideo">
      <!--  <div class="currVideo-content">
        <iframe src="https://www.youtube.com/embed/${videoId}" title="YouTube video player" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        <h2>Header</h2>
        <div class="video-actions">
            <div class="logo-and-content">
                <div id="video-logo"></div>
                <h2 id="video-author">Author</h2>
                <button id="subscribe-btn">Subscribe</button>
            </div>
            <div class="video-action-btns">
                <div class="likeDislike"><i class="ri-thumb-up-line"></i><div id="like-count">1</div>
                <i class="ri-thumb-down-line"></i>
                </div>
                <button id="share-button"><i class="ri-share-forward-line"></i>Share</button>
                <button id="download-button"><i class="ri-download-line"></i>Download</button>
                <button id="more-button"><i class="ri-more-line"></i></button>
            </div>
        </div>
        </div>
        <div class="currVideo-details">

        </div>
        <div class="comments-input">
            <div class="comment-input">
            <div class="user-profile">
                N
            </div>
            <div class="comment-actions">
            <input type="text" id="comment-box" placeholder="Write a comment..." autocomplete="off">
            <div class="comment-buttons">
                <button id="cancel-btn">Cancel</button>
                <button id="comment-btn">Comment</button>
            </div>
            </div>
        </div>
        </div>
        <div class="comments-container"></div>  -->
    </div>
    <div class="video-side-content">
        <!-- <div class="yt-side-card">
        <iframe 
                src="https://www.youtube.com/embed/W7FTkUFU7nw" 
                title="Pokémon Presents | 2.27.2025" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                referrerpolicy="strict-origin-when-cross-origin" 
                allowfullscreen>
            </iframe>
            <div class="yt-side-cards-content">
                <div class="yt-side-cards-header">
                    <h3>Pokémon Presents | 2.27.2025</h3>
                    <i class="fa-solid fa-ellipsis-vertical"></i>
                </div>
                <p>The Official Pokémon YouTube channel</p>
                <p>Trending Video</p>
            </div>
    </div> -->
</div>
    </div>

    <script>
const videoContainer = document.querySelector("#currVideo");
let searchText = window.location.search;
console.log(searchText);
searchText=searchText.replace('?','');
searchText=searchText.split('&');
const videoId = searchText[0].split("=")[1];
const title = decodeURIComponent(searchText[1].split("=")[1]);
console.log(title);
const author = decodeURIComponent(searchText[2].split("=")[1]);
console.log(author);
console.log({videoId, title, author});

// Remove ? by substr or replace method, split the string on the basis of &, split the substrs on the baiss of =.

const commentArr = JSON.parse(localStorage.getItem(`comments_${videoId}`)) || [];

const showVideo = () => {
    const newVideo = document.createElement("div");
    newVideo.classList.add("newVideo");
    newVideo.innerHTML = `
        <div class="currVideo-content">
        <iframe src="https://www.youtube.com/embed/${videoId}" title="YouTube video player" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        <h3>${title}</h3>
        <div class="video-actions">
            <div class="logo-and-content">
                <div id="video-logo"></div>
                <h2 id="video-author">${author}</h2>
                <button id="subscribe-btn">Subscribe</button>
            </div>
            <div class="video-action-btns">
                <div class="likeDislike"><i class="ri-thumb-up-line"></i><div id="like-count">1</div>
                <i class="ri-thumb-down-line"></i>
                </div>
                <button id="share-button"><i class="ri-share-forward-line"></i>Share</button>
                <button id="download-button"><i class="ri-download-line"></i>Download</button>
                <button id="more-button"><i class="ri-more-line"></i></button>
            </div>
        </div>
        </div>
        <div class="currVideo-details">

        </div>
        <div class="comments-input">
            <div class="comment-input">
            <div class="user-profile">
                N
            </div>
            <div class="comment-actions">
            <input type="text" id="comment-box" placeholder="Write a comment..." autocomplete="off">
            <div class="comment-buttons">
                <button id="cancel-btn">Cancel</button>
                <button id="comment-btn">Comment</button>
            </div>
            </div>
        </div>
        </div>
        <div class="comments-container"></div>
    `;
    videoContainer.appendChild(newVideo);

    // Select elements after adding them to the DOM
    const commentButtons = document.querySelector(".comment-buttons");
    const commentBox = document.querySelector("#comment-box");
    const commentContainer = document.querySelector(".comments-container");

    // Show stored comments
    commentArr.forEach(comment => addCommentToUI(commentContainer, comment));

    // Show comment buttons when input is clicked
    commentBox.addEventListener("click", () => {
        commentButtons.style.visibility = 'visible';
    });

    // Hide buttons when clicking outside the input field
    document.addEventListener("click", (event) => {
        if (!commentBox.contains(event.target) && !commentButtons.contains(event.target)) {
            commentButtons.style.visibility = 'hidden';
        }
    });

    // Hide buttons when "Cancel" is clicked
    document.querySelector("#cancel-btn").addEventListener("click", () => {
        commentButtons.style.display = "none";
        commentBox.value = "";
    });

    // Handle comment submission
    document.querySelector("#comment-btn").addEventListener("click", () => {
        const inputComment = commentBox.value.trim();
        if (!inputComment) {
            alert("Comment cannot be empty!");
            return;
        }

        commentArr.push(inputComment);
        localStorage.setItem(`comments_${videoId}`, JSON.stringify(commentArr));

        addCommentToUI(commentContainer, inputComment);
        commentBox.value = "";
    });
};

// Helper function to add comments to UI
const addCommentToUI = (container, commentText) => {
    const commentWrapper = document.createElement("div");
    commentWrapper.classList.add("single-comment");

    const commentElement = document.createElement("p");
    commentElement.classList.add('user-comment')
    commentElement.textContent = commentText;
    commentWrapper.appendChild(commentElement);

    // Like/Dislike section
    const likeDislike = document.createElement("div");
    likeDislike.classList.add("likeDislikeComments");
    likeDislike.innerHTML = `
        <i class="fa-regular fa-thumbs-up"></i>
        <i class="fa-regular fa-thumbs-down"></i>
        <p>Reply</p>
    `;
    commentWrapper.appendChild(likeDislike);

    container.appendChild(commentWrapper);
};

showVideo();

// Retrieve the YouTube history from localStorage
const youtubeHistory = JSON.parse(localStorage.getItem("yt_history")) || [];
console.log("Current History:", youtubeHistory);

// Ensure videoId exists before proceeding
if (videoId) {
    // Check if the video is already in history
    const exists = youtubeHistory.some(video => video.videoId === videoId);

    if (!exists) {
        youtubeHistory.push({ videoId, title, author });
        console.log("Updated History:", youtubeHistory);
        if (youtubeHistory.length > 10) {
        youtubeHistory.shift(); // Remove the oldest entry
    }
        localStorage.setItem("yt_history", JSON.stringify(youtubeHistory));
}
}


const sideRoot = document.querySelector('.video-side-content');
let list=[];
const getYTData = () => {
    fetch("https://youtube138.p.rapidapi.com/v2/trending", {
        method: "GET",
        headers: {
            "x-rapidapi-host": "youtube138.p.rapidapi.com",
            "x-rapidapi-key": "55488db6c3msh794b82f94cd1484p1182c2jsn8bbb8070e1cf",
        },
    })
    .then((res) => res.json())
    .then((data) => {
        list = data.list;
        showSideVideo(data.list); // Pass fetched data to showSideVideo
    })
    .catch((err) => {
        console.log(err);
    });
};

const showSideVideo = (list) => {
    sideRoot.innerHTML = ""; // Clear previous content
    list.forEach((video, index) => {
        // console.log(video, "video logged");
        // Extract video details
        const thumbnail = video.authorThumbnails[5].url;
        // console.log(thumbnail);
        const videoId = video.videoId; 
        // console.log(videoId);
        const title = video.title;
        // console.log(title);
        const newSideCard = document.createElement('div');
        newSideCard.classList.add("yt-side-cards");
        newSideCard.innerHTML = `
    <div class="yt-side-card" onclick="playVideo(this, '${video.id}')">
<div class="imgVideo">
    <!-- Thumbnail (Initially Visible) -->
    <img class="thumbnail" src="${thumbnail}" alt="Video Thumbnail">
    
    <!-- Video Frame (Initially Hidden) -->
    <iframe 
        class="video-frame" 
        style="display: none;" 
        title="${video.title}" 
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen>
    </iframe>
    </div>
    <!-- Video Info -->
    <div class="yt-side-cards-content">
        <div class="yt-side-cards-header">
            <h3>${video.title}</h3>
            <i class="fa-solid fa-ellipsis-vertical"></i>
        </div>
        <p>${video.author}</p>
    </div>
</div>
`;
        sideRoot.appendChild(newSideCard);
    });
};

function playVideo(card, videoId) {
    const thumbnail = card.querySelector(".thumbnail");
    const iframe = card.querySelector(".video-frame");

    // Hide thumbnail and show iframe with video
    thumbnail.style.display = "none";
    iframe.style.display = "block";
    iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
}

// Call the function to fetch and display trending videos
getYTData();

document.addEventListener("DOMContentLoaded", function () {
    const searchBox = document.querySelector("#searchBox");
    const searchHistoryDiv = document.querySelector("#search-history");
    const searchButton = document.querySelector("#search-button");
    const clearSearch = document.querySelector("#cross-search");
    let searchData = [];

    // Function to show search history
    function showSearchHistory() {
        searchHistoryDiv.innerHTML = ""; // Clear previous content
        clearSearch.style.display='block';
        if (searchData.length === 0) {
            searchHistoryDiv.innerHTML = "<p>No recent searches</p>";
        } else {
            searchData.forEach((searchText, index) => {
                const newSearch = document.createElement("div");
                newSearch.classList.add("new-search");
                newSearch.innerHTML = `
                    <i class="ri-history-line"></i>
                    <p>${searchText}</p>
                    <i class="fa-solid fa-xmark" onclick="removeSearch(${index})"></i>
                `;
                searchHistoryDiv.appendChild(newSearch);
            });
        }
        searchHistoryDiv.style.display = "block"; // Show search history
    }

    // Function to remove search from history
    window.removeSearch = function (index) {
        searchData.splice(index, 1);
        showSearchHistory(); // Refresh the UI
    };

    // Function to filter and display search results
    function filterAndDisplay(query) {
        const filteredData = list.filter(video =>
            video.title.toLowerCase().trim().includes(query) ||
            video.author.toLowerCase().trim().includes(query)
        );
        console.log(filteredData); // For debugging
        showSideVideo(filteredData);
    }

    // Function to handle search button click
    function handleSearchButton() {
        const query = searchBox.value.trim().toLowerCase();
        if (query !== "") {
            if (!searchData.includes(query)) {
                searchData.push(query);
            }
            filterAndDisplay(query); // Call the filtering function
        }
        searchData.reverse();
        showSearchHistory();
    }

    // Attach event listeners
    searchBox.addEventListener("focus", showSearchHistory);
    searchBox.addEventListener("blur", function () {
        setTimeout(() => {
            searchHistoryDiv.style.display = "none";
            clearSearch.style.display='none';
        }, 200); 
    });

    searchButton.addEventListener("click", handleSearchButton);

    clearSearch.addEventListener("click", () => {
        console.log("clear search");
        searchBox.value = "";  // Clears input
        searchBox.focus();  // Keeps focus on search input
        // document.querySelector("#search-history").style.display = "none"; // Hide search history
    });
});


    </script>
    <!-- <script src="script.js"></script> -->
</body>
</html>


 <!-- <div class="yt-side-card">
    <iframe 
            src="https://www.youtube.com/embed/${video}" 
            title=${video} 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
            referrerpolicy="strict-origin-when-cross-origin" 
            allowfullscreen>
        </iframe>
        <div class="yt-side-cards-content">
            <div class="yt-side-cards-header">
                <h3>${video.title}</h3>
                <i class="fa-solid fa-ellipsis-vertical"></i>
            </div>
            <p>${video.author}</p>
        </div>
</div> -->